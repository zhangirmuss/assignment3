<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Items - FitTrack</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    .item-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:12px; }
    .item-card{ padding:12px; border-radius:8px; background:rgba(255,255,255,0.02); }
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.03); }
    .form-row{ display:flex; gap:8px; margin-bottom:12px; }
    input[type="text"]{ padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit; }
    button{ padding:8px 12px; border-radius:6px; border:none; background:linear-gradient(90deg,var(--accent),var(--accent3)); color:#fff; cursor:pointer; }
  </style>
</head>
<body>
  <header class="container">
    <h1>Items</h1>
    <nav class="nav"><a href="/">Home</a> <a href="/search">Search</a> <a href="/dashboard">Dashboard</a> <a href="/info">Info</a> <a href="/stats">Stats</a> <a href="/contact">Contact</a></nav>
  </header>

  <main class="container content">
    <section class="accent-card">
      <h2>All Items (from API)</h2>
      <form id="create" style="margin-bottom:12px;">
        <div class="form-row">
          <input id="new-title" type="text" placeholder="Title">
          <input id="new-description" type="text" placeholder="Description">
          <button type="submit">Create</button>
        </div>
      </form>

      <table class="table" id="items-table">
        <thead><tr><th>Id</th><th>Title</th><th>Description</th><th>Actions</th></tr></thead>
        <tbody id="items-body"><tr><td colspan="4" class="muted">Loading...</td></tr></tbody>
      </table>
    </section>
  </main>

  <script>
    async function apiFetch(url, options){
      const res = await fetch(url, options);
      if(!res.ok){ const txt = await res.text(); throw new Error(txt || res.statusText); }
      return await res.json();
    }

    function escapeHtml(s){ return String(s).replace(/[&<>'"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

    async function load(){
      const tbody = document.getElementById('items-body');
      try{
        const items = await apiFetch('/api/items');
        if(!items || !items.length){ tbody.innerHTML = '<tr><td colspan="4" class="muted">No items</td></tr>'; return; }
        tbody.innerHTML = '';
        items.forEach(it =>{
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${it.id}</td><td>${escapeHtml(it.title)}</td><td>${escapeHtml(it.description)}</td><td><button data-id="${it.id}" class="edit">Edit</button> <button data-id="${it.id}" class="del">Delete</button></td>`;
          tbody.appendChild(tr);
        });
      } catch (e){ tbody.innerHTML = '<tr><td colspan="4" class="muted">Failed to load</td></tr>'; }
    }

    document.getElementById('create').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const title = document.getElementById('new-title').value.trim();
      const description = document.getElementById('new-description').value.trim();
      if(!title || !description){ alert('Title and description required'); return; }
      try{ await apiFetch('/api/items', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ title, description }) }); document.getElementById('new-title').value=''; document.getElementById('new-description').value=''; load(); } catch (e){ alert('Create failed'); }
    });

    document.getElementById('items-body').addEventListener('click', async (e)=>{
      const id = e.target.getAttribute('data-id');
      if(e.target.classList.contains('del')){
        if(!confirm('Delete item?')) return;
        try{ await apiFetch(`/api/items/${id}`, { method:'DELETE' }); load(); } catch(e){ alert('Delete failed'); }
      }
      if(e.target.classList.contains('edit')){
        // simple prompt-based edit
        try{
          const item = await apiFetch(`/api/items/${id}`);
          const newTitle = prompt('Title', item.title);
          if(newTitle === null) return;
          const newDesc = prompt('Description', item.description);
          if(newDesc === null) return;
          await apiFetch(`/api/items/${id}`, { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ title: newTitle, description: newDesc }) });
          load();
        } catch (e){ alert('Edit failed'); }
      }
    });

    load();
  </script>
</body>
</html>